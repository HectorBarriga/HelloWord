1. Install and run container
Notes:
- Install gitlab-ee (GitLab Enterprise Edition) docker image from hub.docker.com. Dont insall community edition. EE is free and uses free license. CE is free but EE with free licence does the same as CE. EE has the option to be upgraded and wouldnt have to be reinstalled if CE is installed initially
- Based on https://docs.gitlab.com/ee/install/docker.html
- Image is available on https://hub.docker.com/r/gitlab/gitlab-ee/
- If air-gapped VM, install exported_images/gitlab_latest.tar from docker repository "CO_HQ_Repository".
- To learn about how to Checkin/Checkout/commit/merge RepoScripts from/to DEVOPS-HECT-VM1 or from/to gitlab
  https://www.youtube.com/watch?v=4lxvVj7wlZw

Follow instructions from "IMAGE 12" from C:\Users\hbarriga\Documents\TANGO\MANUALS\DevOps\Docker\How to install Docker.txt . Dont pull, clone, save, install original official jenkins from hub.docker.com.

2. Set password

2.0 Add gitlab.sstl113.csg (or gitlab.tango.csg) alias in /etc/hosts
Notes:
- Ssh VM on where gitlab docker container is running
docker exec -it --user 0 gitlab-server /bin/bash 
root@gitlab:/etc#  echo "10.14.38.112 gitlab.sstl113.csg sstl113 jenkinks.sstl113.csg"  >> /etc/hosts       <<<<<<<<<<<<< sstl113 Mobily
root@gitlab:/etc#  echo "192.168.240.78 gitlab.tango.csg DEVOPS-HECTOR-VM1 jenkinks.tango.csg"  >> /etc/hosts       <<<<<<<<<<<<< DEVOPS-HECTOR-VM1
root@gitlab:/etc#  cat /etc/hosts
root@gitlab:/etc# ln -s /etc/hosts /etc/gitlab/hosts



2.1 Get temporal password
docker exec -it gitlab-server grep 'Password:' /etc/gitlab/initial_root_password  <<<<<<<<<<< To obtain temporal password. 
root  / temporal password 

2.2 Click on user icon top right hand courner, click on "Edit Profile" and click on "Password" which is on the left menu
root/t3l3com123

2.3 Log back in

Open GUI   https://localhost:80   <<<<<<<<< In Mobily, I used IP as laptop can reach VM directly (not tunel)
root/t3l3com123

3. Close (click on X) for the "View setting" message on top

4. Add SSH key (public key) on gitlab GUI

4.1 Generate pub and private keys
Notes: 
- SSH Call flows:
   jenkinks GUI (id_rsa_jenkins_or_gitclient) ----ssh----->  DEVOPS-HECTOR-VM1 (id_rsa_jenkins_or_gitclient.pub) [tango user]  
- You can create this on any VM. You should do it on jenkins continer. It should have been done already when creating docker contianer. Check C:\Users\barhec02\OneDrive - CSG Systems Inc\Documents\TANGO\MANUALS\DevOps\Docker\How to install Docker.txt 
- Dont use passphrase, then on jenkinks you need to leave it empty when adding the credential


Generate private and publick key. Check step  "Add ssh Passwordless connection towards gitlab.sstl113.csg (or gitlab.tango.csg)" in "IMAGE 11:" from  C:\Users\barhec02\OneDrive - CSG Systems Inc\Documents\TANGO\MANUALS\DevOps\Docker\How to install Docker.txt 


4.2 Add jenkins' public key onto gitlab (GUI)
Notes:
- Publick key has to be obtained from Jenkinks container 
- Call flow
   jenkinks GUI (id_rsa_jenkins_or_gitclient) ----ssh----->  DEVOPS-HECTOR-VM1 (id_rsa_jenkins_or_gitclient.pub) [tango user] 

ssh root@DEVOPS-HECTOR-VM1
docker exec -it --user 0 jenkinks-server /bin/bash 
cat /root/.ssh/id_rsa_jenkins_or_gitclient.pub and paste in "Key" box on gitlab gui

Go to gitlab GUI, Click on user icon top right hand courner, click on "Edit Profile" and click on "SSH Keys" which is on the left menu

Title = id_rsa_jenkins_or_gitclient          <<<<<<<< On laptop I didnt bother to fix it as I never used it
Expiration date = 31 12 2040

6. Add Jenkins API token
Notes:
- Based on https://plugins.jenkins.io/gitlab-plugin/  (Once you have installed gitlab plugin on Jenkins, you can get this help from the availabe plugin : Jenkins > Manage Jenkins > Installed > gitlab (search) and click on "Gitlab plugin"
- On this guide, we will do it for root user because we configured jenkins - gitlab integration (RepoScripts credentials) for root user. (To be improved for user per repo. Check section "Configuring per-project authentication" from https://plugins.jenkins.io/gitlab-plugin/)
- root user in Jenkins has Job/Build permissions
- Also read http://192.168.240.78//help/integration/jenkins

6.1 Follow steps "8.1.2.1.1 Configuring global authentication (root user)" from "How to install Jenkins.txt". If token is already created, you might have to recreate it again. Becareful with other projects, you might brake them. 

For, DEVOPS-HECT-VM1, the toke is 116dc3804be96edbf073bf99ce651ff621 (try 115253783fc6146ea86feb2f202fa163eb)

For Mobily sstl113: 11529a0ad2d52a2f6826d8b07c5713ae4b

- Call flows:
		gitlab (commit)   --------- Push notification -----> [API] Jenkins (Trigger build job)   
		
6.2	Create the new porject in gitlab
Follow steps "5.1.2 Create a new project "RepoScripts"  from "How to install Jenkins.txt"






7. Add Gitlap API access token for jenkins to send build status messages to gitlab
Notes:
- Call flow:
	Jenkins   -------- access access authentication --------> [API] GitLab
	Jenkins   -------- build status messages ---------------> [API] GitLab    <<<<<<< It is not for checking out repos. For that, see step 4 above
- Based on https://plugins.jenkins.io/gitlab-plugin/  (Once you have installed gitlab plugin on Jenkins, you can get this help from the availabe plugin : Jenkins > Manage Jenkins > Installed > gitlab (search) and click on "Gitlab plugin"
- Read step "5.4.5 Set up credentials with user and password. Click on "Add" button and select "RepoScripts". from "How to install Jenkins.txt" guide
- Also read http://192.168.240.78/help/integration/jenkins

7.1 Login to gitlab as root user  (admin user)
Notes:
- This root account is used by Jenkins to access the GitLab projects. We recommend creating a GitLab
user for only this purpose. If you use a person's account, and their account is deactivated or
deleted, the Jenkins integration stops working.

7.2 Give root user 'Maintainer' permissions on each repo you want Jenkins to send build status to 
7.3 Log in as "root" or 'Impersonate' that user in GitLab, click the user's icon/avatar and click on "Edit profile". Skip this step, you are using root user
7.4 Click on 'Access Tokens'
7.5 Create a token named "API_token_gitlab" and expiration 2040-12-31
7.6 Tick all options. Especially "api"
7.7 Click on created new token blue button. (Ignore hidden token at the end of page. Create and you will see final token afterwards. See next step 7.9)
7.8 Copy the token immediately. <<<<< It cannot be accessed after you leave the page. IT IS ON TOP OF THE PAGE. IT IS NOT THE ONE HIDEN AT THE BOTTOM!!! DONT MAKE THAT MISTAKE
Example:  
Qd-gzfYpgzDiSdhxZoSs  << Laptop    
NmKN4Ry5Mnn1L57XhW2a << Mobily

7.9 Go to Jenkins GUI to "Global Configuration page in Jenkins". (You can open it directly like this http://192.168.240.78:8080/configure or http://10.14.38.112:8080/configure)  
Notes:
- gitlab plugin must have been installed on Jenkins GUI
- DO NOT LEAVE SPACES (ESPECIALLY AT THE END OF EACH ENTER BOX)

7.9.0 Tick on "Enable authentication for '/project' end-point"

7.9.1 Connection name = API_token_gitlab

7.9.2 In the GitLab configuration section supply the GitLab host URL:
Notes:
- Do not use https, else it wont work!

http://gitlab.tango.csg  <<<< DEVOPS-HECT-VM1
http://gitlab.sstl113.csg  << Mobily

7.9.3 Click the 'Add' button to add a credential, Select "Jenkins", choose 'GitLab API token' as the kind of credential, select Scope "Global (Jenkins, nodes, items, all child items, etc)" , and paste your GitLab user's API key (created in step "7.8 Copy the token immediately") into the 'API token' field, ID = API_token_gitlab and Description = "API_token_gitlab - jenkins to send build status to gitlab"

7.9.4 Click the 'Test Connection' button; it should succeed


8. Checkin/Checkout/commit/merge RepoScripts from/to DEVOPS-HECT-VM1 or from/to gitlab
Notes:
- https://www.youtube.com/watch?v=4lxvVj7wlZw

Follow steps from "GIT - Hector RepoScripts.txt"

9. Create new project

Follow steps C:\Users\barhec02\OneDrive - CSG Systems Inc\Documents\TANGO\MANUALS\DevOps\Jenkins\How to install Jenkins steps 5.2 and 5.3



